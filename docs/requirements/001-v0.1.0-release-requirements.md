# Ralph Desktop v0.1.0 发布需求文档

**版本**: 0.1.0
**创建日期**: 2026-01-31
**状态**: 待审核

---

## 目录

1. [需求概述](#1-需求概述)
2. [需求详情](#2-需求详情)
   - [2.1 Github 公开仓库](#21-github-公开仓库)
   - [2.2 应用图标](#22-应用图标)
   - [2.3 版本号管理](#23-版本号管理)
   - [2.4 自动化发布](#24-自动化发布)
   - [2.5 多语言支持](#25-多语言支持)
   - [2.6 OpenCode CLI 支持](#26-opencode-cli-支持)
3. [代码清理](#3-代码清理)
4. [验收标准](#4-验收标准)
5. [技术实现要点](#5-技术实现要点)

---

## 1. 需求概述

本次 v0.1.0 版本发布包含以下核心需求：

| 编号 | 需求 | 优先级 |
|------|------|--------|
| REQ-001 | 创建 Github 公开仓库 | P0 |
| REQ-002 | 更换应用图标为 Ralph Wiggum 风格 | P0 |
| REQ-003 | 引入版本号管理机制 | P0 |
| REQ-004 | 配置 Github Actions 自动打包发布 | P0 |
| REQ-005 | 支持 12 种语言的 UI 国际化 | P1 |
| REQ-006 | 新增 OpenCode CLI 适配器 | P1 |
| REQ-007 | 清理遗留代码 | P2 |

---

## 2. 需求详情

### 2.1 Github 公开仓库

**需求编号**: REQ-001

#### 描述
将项目发布到 Github 作为公开仓库，供用户下载和贡献。

#### 详细要求

| 项目 | 内容 |
|------|------|
| 仓库地址 | `https://github.com/liuxiaopai-ai/ralph-desktop`（作为唯一官方仓库） |
| 仓库可见性 | Public（公开） |
| 默认分支 | `main` |
| PR 审批 | 所有 PR 需经项目负责人审批后合并 |

#### 备注
- 当前本地项目目录名为 `ralph-desktop-cc`，无需强制改名
- 代码仓库将迁移/更名到 `liuxiaopai-ai/ralph-desktop`（进行中）

#### 需要配置的仓库设置
- [ ] Branch protection rules（分支保护规则）
- [ ] Require pull request reviews（要求 PR 审核）
- [ ] 配置 CODEOWNERS 文件（可选）

#### 不在本次范围
- 贡献者指南（CONTRIBUTING.md）
- 行为准则（CODE_OF_CONDUCT.md）

---

### 2.2 应用图标

**需求编号**: REQ-002

#### 描述
将应用图标更换为 Ralph Wiggum（《辛普森一家》角色）的致敬风格卡通头像。

#### 详细要求

| 项目 | 内容 |
|------|------|
| 设计风格 | SVG 手绘，致敬风格（非直接使用版权图片） |
| 特征元素 | 圆脸、金色头发、蓝色眼睛、友善表情 |
| 背景 | 透明或纯色（适配浅色/深色主题） |

#### 需要生成的图标文件

**macOS**:
- `icon.icns`（包含 16x16 到 1024x1024 多种尺寸）

**Windows**:
- `icon.ico`（包含 16x16 到 256x256 多种尺寸）

**Linux**:
- `icon.png`（256x256 或 512x512）

**通用**:
- `32x32.png`（托盘图标）
- `128x128.png`（应用列表图标）
- `128x128@2x.png`（高分屏图标）

#### 文件存放位置
```
src-tauri/icons/
├── icon.icns          # macOS
├── icon.ico           # Windows
├── icon.png           # Linux / 通用
├── 32x32.png          # 托盘图标
├── 128x128.png        # 标准图标
└── 128x128@2x.png     # 高分屏图标
```

---

### 2.3 版本号管理

**需求编号**: REQ-003

#### 描述
引入规范的版本号管理机制，遵循 Semantic Versioning (SemVer) 规范。

#### 版本号格式
```
MAJOR.MINOR.PATCH
```

| 部分 | 含义 | 示例 |
|------|------|------|
| MAJOR | 不兼容的 API 变更 | 1.0.0 → 2.0.0 |
| MINOR | 向后兼容的功能新增 | 0.1.0 → 0.2.0 |
| PATCH | 向后兼容的问题修复 | 0.1.0 → 0.1.1 |

#### 版本号更新时机
- **每次发布（打 tag）时**更新版本号
- **不是**每次 commit 自动增加

#### 版本号同步位置
发布时需要同步更新以下文件：

| 文件 | 字段 |
|------|------|
| `package.json` | `"version": "x.x.x"` |
| `src-tauri/Cargo.toml` | `version = "x.x.x"` |
| `src-tauri/tauri.conf.json` | `"version": "x.x.x"` |

#### 当前版本与下一版本
- 当前版本：`0.1.0`（首次发布）
- 下一版本：`0.1.1`（补丁更新）或 `0.2.0`（功能更新）

#### 推荐工具（可选）
可考虑使用 `cargo-release` 或自定义脚本来自动同步版本号。

---

### 2.4 自动化发布

**需求编号**: REQ-004

#### 描述
配置 Github Actions，在打 tag 时自动构建全平台安装包并发布到 Github Releases。

#### 触发条件
```yaml
on:
  push:
    tags:
      - 'v*'  # 匹配 v0.1.0, v0.1.1, v1.0.0 等
```

#### 构建目标平台

| 平台 | 架构 | 产出物 |
|------|------|--------|
| macOS | x64 (Intel) | `.dmg`, `.app.tar.gz` |
| macOS | arm64 (Apple Silicon) | `.dmg`, `.app.tar.gz` |
| Windows | x64 | **同时产出** `.msi` 与 `.exe` (NSIS) |
| Linux | x64 | `.deb`, `.AppImage` |

#### 代码签名
- **本次不进行代码签名**
- macOS：用户需右键打开或在系统设置中允许
- Windows：用户会看到 SmartScreen 警告"未知发布者"
- Linux：无影响

#### Github Actions 工作流文件
```
.github/workflows/
└── release.yml
```

#### 发布内容
每次 Release 应包含：
- [ ] 各平台安装包（见上表）
- [ ] 自动生成的 Release Notes（基于 commits）
- [ ] SHA256 校验和文件（可选）

#### 参考实现
使用 Tauri 官方推荐的 `tauri-action`：
```yaml
- uses: tauri-apps/tauri-action@v0
  with:
    tagName: ${{ github.ref_name }}
    releaseName: 'Ralph Desktop ${{ github.ref_name }}'
    releaseBody: 'See the assets to download this version and install.'
    releaseDraft: false
    prerelease: false
```

---

### 2.5 多语言支持

**需求编号**: REQ-005

#### 描述
支持 12 种语言的 UI 国际化，用户可在设置面板中切换语言，选择将被持久化保存。

#### 支持的语言列表

| 序号 | 语言 | 代码 | 备注 |
|------|------|------|------|
| 1 | English | `en` | 默认语言 |
| 2 | 简体中文 | `zh-CN` | 第二优先 |
| 3 | 繁體中文 | `zh-TW` | - |
| 4 | Español | `es` | 西班牙语 |
| 5 | हिन्दी | `hi` | 印地语 |
| 6 | العربية | `ar` | 阿拉伯语（RTL） |
| 7 | Português | `pt` | 葡萄牙语 |
| 8 | Русский | `ru` | 俄语 |
| 9 | 日本語 | `ja` | 日语 |
| 10 | Deutsch | `de` | 德语 |
| 11 | Français | `fr` | 法语 |
| 12 | বাংলা | `bn` | 孟加拉语 |

#### 国际化范围

**需要翻译**:
- 所有 UI 组件中的静态文本
- 按钮标签、菜单项、提示信息
- 设置面板选项
- 错误提示和通知消息
- 键盘快捷键帮助面板

**不需要翻译**:
- AI Brainstorm 对话内容（已实现自动语言匹配）
- 向导式 Brainstorm 预设问题（已删除）
- CLI 输出日志
- 技术术语和代码

#### 语言设置

**设置入口**: 设置面板（Settings Panel）

**设置项**:
```typescript
interface GlobalConfig {
  // ... 现有字段
  language: string;  // 新增：语言代码，默认 'en'
}
```

**持久化**: 保存到 `config.json`，应用启动时加载

**语言优先级**:
1. 用户设置（显式选择）
2. 系统语言（未设置时自动跟随系统）
3. 默认 `en`

#### 技术实现建议

**推荐方案**: 使用 `svelte-i18n` 库

```bash
pnpm add svelte-i18n
```

**翻译文件结构**:
```
src/lib/i18n/
├── index.ts          # i18n 初始化配置
└── locales/
    ├── en.json       # 英语（默认）
    ├── zh-CN.json    # 简体中文
    ├── zh-TW.json    # 繁體中文
    ├── es.json       # 西班牙语
    ├── hi.json       # 印地语
    ├── ar.json       # 阿拉伯语
    ├── pt.json       # 葡萄牙语
    ├── ru.json       # 俄语
    ├── ja.json       # 日语
    ├── de.json       # 德语
    ├── fr.json       # 法语
    └── bn.json       # 孟加拉语
```

#### 特殊考虑

**RTL（从右到左）支持**:
- 阿拉伯语（ar）需要 RTL 布局支持
- 可使用 CSS `direction: rtl` 和 `[dir="rtl"]` 选择器

**字体支持**:
- 确保 Tailwind CSS 配置中的字体栈支持各语言字符
- 特别注意：印地语、阿拉伯语、孟加拉语可能需要额外字体

---

### 2.6 OpenCode CLI 支持

**需求编号**: REQ-006

#### 描述
在现有 Claude Code 和 Codex 适配器基础上，新增 OpenCode CLI 适配器支持。

#### OpenCode 项目信息

| 项目 | 内容 |
|------|------|
| Github | https://github.com/opencode-ai/opencode |
| 类型 | AI 编码助手 CLI 工具 |

#### 适配器实现

**新增文件**:
```
src-tauri/src/adapters/opencode.rs
```

**需要实现的 trait 方法**:

```rust
impl CliAdapter for OpenCodeAdapter {
    fn name(&self) -> &'static str;
    fn cli_type(&self) -> CliType;
    fn is_installed(&self) -> bool;
    fn get_path(&self) -> Option<PathBuf>;
    fn version(&self) -> Option<String>;
    fn build_command(&self, prompt: &str, working_dir: &Path, options: CommandOptions) -> Command;
    fn build_readonly_command(&self, prompt: &str, working_dir: &Path, options: CommandOptions) -> Command;
    fn detect_completion(&self, output: &str, signal: &str) -> bool;
    fn parse_output_line(&self, line: &str) -> ParsedLine;
}
```

#### CLI 类型枚举更新

**修改文件**: `src-tauri/src/storage/models.rs`

```rust
#[derive(Debug, Clone, Serialize, Deserialize, PartialEq)]
#[serde(rename_all = "lowercase")]
pub enum CliType {
    Claude,
    Codex,
    OpenCode,  // 新增
}
```

#### 前端 UI 更新

**修改文件**:
- `src/lib/types/index.ts` - 添加 `'opencode'` 到 CliType
- `src/lib/components/AiBrainstorm.svelte` - CLI 选择下拉框添加 OpenCode 选项
- `src/lib/components/SettingsPanel.svelte` - 默认 CLI 选项添加 OpenCode

#### 需要调研的内容
在实现前需要确认 OpenCode CLI 的：
- [ ] 命令行参数格式
- [ ] 输出格式（JSON/Text/Stream）
- [ ] 完成信号检测方式
- [ ] 只读模式支持情况

---

## 3. 代码清理

**需求编号**: REQ-007

#### 描述
删除不再使用的遗留代码，保持代码库整洁。

#### 待删除文件

| 文件 | 原因 |
|------|------|
| `src/lib/components/BrainstormWizard.svelte` | 已被 AI Brainstorm 取代，无引用 |

#### 待清理的相关代码
- [ ] 检查并删除 `BrainstormWizard` 相关的类型定义
- [ ] 检查并删除后端 `getBrainstormQuestions` 相关代码（如果不再使用）

---

## 4. 验收标准

### REQ-001 Github 公开仓库
- [ ] 仓库 `liuxiaopai-ai/ralph-desktop` 已创建且为 Public
- [ ] main 分支有保护规则
- [ ] 代码已推送到仓库

### REQ-002 应用图标
- [ ] 所有平台图标文件已生成并放置在正确位置
- [ ] 应用启动后显示新图标
- [ ] 托盘图标正确显示

### REQ-003 版本号管理
- [ ] 所有版本号相关文件已同步为 `0.1.0`
- [ ] 有明确的版本号更新流程文档

### REQ-004 自动化发布
- [ ] 推送 `v0.1.0` tag 后自动触发构建
- [ ] macOS (x64 + arm64)、Windows、Linux 包均成功构建
- [ ] Windows 同时包含 `.msi` 与 `.exe` 两种安装包
- [ ] Github Releases 页面有所有安装包下载

### REQ-005 多语言支持
- [ ] 设置面板可选择 12 种语言
- [ ] 切换语言后 UI 文本正确更新
- [ ] 语言设置重启后保持

### REQ-006 OpenCode CLI 支持
- [ ] OpenCode 适配器已实现
- [ ] 可在 UI 中选择 OpenCode 作为执行 CLI
- [ ] Loop 执行流程与 Claude/Codex 一致

### REQ-007 代码清理
- [ ] `BrainstormWizard.svelte` 已删除
- [ ] 无编译错误（警告可接受）

---

## 5. 技术实现要点

### 5.1 Github Actions 配置注意事项

**Secrets 配置**（如需签名，本次不需要）:
- `APPLE_CERTIFICATE` - Apple 开发者证书
- `APPLE_CERTIFICATE_PASSWORD` - 证书密码
- `APPLE_SIGNING_IDENTITY` - 签名身份
- `APPLE_ID` / `APPLE_PASSWORD` - 公证用
- `TAURI_PRIVATE_KEY` / `TAURI_KEY_PASSWORD` - 更新签名

**本次无需配置上述 Secrets**，因为不进行代码签名。

### 5.2 多语言实现架构

```
用户选择语言
      ↓
更新 config.language
      ↓
保存到 config.json (Rust 后端)
      ↓
svelte-i18n 切换 locale
      ↓
UI 响应式更新
```

### 5.3 OpenCode 适配器开发顺序

1. 调研 OpenCode CLI 接口
2. 添加 `CliType::OpenCode` 枚举
3. 实现 `OpenCodeAdapter` 结构体
4. 注册到适配器列表
5. 更新前端 UI
6. 端到端测试

---

## 附录

### A. 相关文档
- [Tauri Action 文档](https://github.com/tauri-apps/tauri-action)
- [svelte-i18n 文档](https://github.com/kaisermann/svelte-i18n)
- [Semantic Versioning](https://semver.org/)

### B. 变更记录

| 日期 | 版本 | 变更内容 | 作者 |
|------|------|----------|------|
| 2026-01-31 | 1.0 | 初稿创建 | Claude |
